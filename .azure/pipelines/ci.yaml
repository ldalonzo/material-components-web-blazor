name: $(Major).$(Minor).$(rev:r)

resources:
- repo: self
  clean: true

pool:
  name: Hosted Windows 2019 with VS2019
  demands:
  - npm

variables:
  Major: 0
  Minor: 1
  BuildConfiguration: 'Release'

steps:
- checkout: self
  clean: true

- task: Npm@1
  displayName: 'Build Static Assets - npm ci'
  inputs:
    command: ci
    workingDir: src\Blazor.Material
    verbose: false

- task: Npm@1
  displayName: 'Build Static Assets - npm run build'
  inputs:
    command: custom
    workingDir: src\Blazor.Material
    verbose: false
    customCommand: 'run build'

- task: DotNetCoreCLI@2
  displayName: 'dotnet test'
  inputs:
    command: test
    projects: |
     **/Test.Blazor.Material.Components
    arguments: '--configuration $(BuildConfiguration)'

- task: DotNetCoreCLI@2
  displayName: 'dotnet publish'
  inputs:
    command: publish
    publishWebProjects: false
    projects: |
     **/Blazor.Material.Components.WebApp.csproj
    arguments: '--configuration $(BuildConfiguration) --output $(Build.ArtifactStagingDirectory) -p:Version=$(Build.BuildNumber)'

- task: PublishBuildArtifacts@1
  displayName: 'Publish Artifact: drop'
